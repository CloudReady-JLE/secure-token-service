language: java

jdk:
  - oraclejdk8

services:
  - docker

install:
  - mvn --settings .travis/settings.xml clean install -DskipTests -Dmaven.javadoc.skip=true -B -V

script:
  - mvn --settings .travis/settings.xml clean package -DskipTests -B -V

before_deploy:
  - echo $GPG_SECRET_KEY | base64 --decode | $GPG_EXECUTABLE --import
  - echo $GPG_OWNERTRUST | base64 --decode | $GPG_EXECUTABLE --import-ownertrust

deploy:
  -
    skip_cleanup: true
    provider: script
    script: /bin/bash .travis/deploy.sh
    on:
      tags: true
      # matches: vX.Y.Z, vX.Y.Z-A, vX.Y.Z-A-B.C.D, vX.Y.Z-A-B.C.D-E
      condition: "$TRAVIS_TAG =~ ^v([[:digit:]]+\\.)+[[:digit:]]+(-[[:digit:]]+)?(-([[:digit:]]+\\.)+[[:digit:]]+(-[[:digit:]]+)?)?$"

env:
  global:
  - STS_EXAMPLE_DOCKER_IMAGE_NAME=adorsys/sts-example
  - secure: GR2Ms2g0lNF9ZbvPSdARI6FHPMds224kLIrU7lXvclDUGHr+2O1j6prYes/miIcDZ8CDa5lRfVS7opX7pc/r9QaJMLaJzGFIuax2sIlJtZLxpCqmbbp9aFCRLX6mPCx4ezbyeHUhp3H6aajLCy1NOHGHPsU5QGF5sxgY7xl7eYUwYWS+2LGRZKTs9/pwwV6cJbk3iRsEZyo5stB3gMn2vbu9A5oxVGqPxug5IGx15PGVnkvUgF73Z9r1qRIBfwsrA6mMWmiagbjpgj+FujDMSQR4ucP77SiDPAsLorQIrnhKfweun4kY6puTfnwZZ7yWw3UFHiqinEY5Vv1zHZwnTL8ylC2Vi3e6qTbwZYown5bWoquCz0P9o7pJzTMhqtwQDdT0pqlM3G5L6ZEi08yK2JxEpu3zBCl14yLjqRvXWohxG2Uw8rbSh28zsISQHDyVZZA4fdHeVS/hz5j5lEF8uH4y/VwxicafeFw8naJqpV8OU/LwGINzZFKAsmAHpwL8xM7YeIuWdACa5okqWvAz4z4/ip5FRkFlnhu9kcmXe+AcssVWjf92yG6fn42lE2g2d5hvm5AIB6GQa1Q9QeT1YlR3/ag1TwxDvMgwGO+vAsEdAMApQsBfSyETRRR/AO15uP6LIqgIPZ9Q4bw1mjCyRdTLp7dmhYR8Kf1GKCjSIBY=
